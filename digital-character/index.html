<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber Studio | Qwen & Pollinations</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Noto+Serif+SC:wght@300;900&display=swap');
        
        body {
            background: #020617;
            background-image: fixed;
            background-image: radial-gradient(circle at 10% 20%, #1e1b4b 0%, transparent 50%),
                              radial-gradient(circle at 90% 80%, #312e81 0%, transparent 50%);
            font-family: 'Segoe UI', sans-serif;
        }

        .cyber-panel {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(139, 92, 246, 0.2);
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
        }

        .title-font { font-family: 'Orbitron', sans-serif; letter-spacing: 0.1em; }
        .poem-font { font-family: 'Noto Serif SC', serif; writing-mode: horizontal-tb; }

        .loading-glow {
            animation: glow 2s infinite alternate;
        }
        @keyframes glow {
            from { opacity: 0.4; text-shadow: 0 0 5px #8b5cf6; }
            to { opacity: 1; text-shadow: 0 0 20px #8b5cf6; }
        }

        .custom-input {
            background: rgba(2, 6, 23, 0.8);
            border: 1px solid #334155;
            transition: all 0.3s;
        }
        .custom-input:focus {
            border-color: #8b5cf6;
            box-shadow: 0 0 10px rgba(139, 92, 246, 0.3);
            outline: none;
        }
    </style>
</head>
<body class="text-slate-300 min-h-screen flex items-center justify-center p-4 md:p-8">

    <div class="w-full max-w-6xl">
        <header class="mb-10 text-center lg:text-left">
            <h1 class="title-font text-3xl md:text-5xl font-extrabold text-white mb-2">
                <span class="text-purple-500">CYBER</span> CHARACTER
            </h1>
            <div class="h-1 w-20 bg-purple-600 rounded-full mb-2 mx-auto lg:mx-0"></div>
            <p class="text-slate-500 text-xs tracking-widest uppercase">Hybrid Intelligence Synthesis Engine</p>
        </header>

        <main class="flex flex-col lg:flex-row gap-8 items-start">
            
            <aside class="w-full lg:w-1/3 space-y-6">
                <div class="cyber-panel p-8 rounded-2xl">
                    <h3 class="text-purple-400 font-bold mb-6 flex items-center gap-2">
                        <span class="text-xl">01</span> 初始化核心参数
                    </h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="text-[10px] uppercase text-slate-500 font-bold mb-1 block">Subject / 核心特征</label>
                            <input type="text" id="kw1" placeholder="例如: Mechanical Samurai" class="custom-input w-full p-3 rounded-lg text-sm">
                        </div>
                        <div>
                            <label class="text-[10px] uppercase text-slate-500 font-bold mb-1 block">Environment / 场景</label>
                            <input type="text" id="kw2" placeholder="例如: Acid Rain Alley" class="custom-input w-full p-3 rounded-lg text-sm">
                        </div>
                        <div>
                            <label class="text-[10px] uppercase text-slate-500 font-bold mb-1 block">Element / 核心视觉</label>
                            <input type="text" id="kw3" placeholder="例如: Holographic Wings" class="custom-input w-full p-3 rounded-lg text-sm">
                        </div>
                    </div>

                    <button onclick="generate()" id="btn" class="w-full mt-8 py-4 bg-purple-700 hover:bg-purple-600 text-white font-bold rounded-xl transition-all shadow-lg shadow-purple-900/20 active:translate-y-1">
                        同步神经链接
                    </button>
                </div>

                <div class="px-4 py-2 text-[10px] text-slate-600 font-mono border-l border-slate-800">
                    Status: System Ready<br>
                    Model: Qwen-1.7B-Instruct<br>
                    Visual: Pollinations FLUX
                </div>
            </aside>

            <section class="w-full lg:w-2/3 min-h-[600px] flex">
                <div id="emptyState" class="w-full flex items-center justify-center border-2 border-dashed border-slate-800 rounded-2xl">
                    <p class="text-slate-600 font-mono animate-pulse">Awaiting parameters...</p>
                </div>

                <div id="resultBox" class="hidden w-full cyber-panel rounded-2xl overflow-hidden flex flex-col md:flex-row shadow-2xl">
                    <div class="md:w-1/2 relative bg-black aspect-[9/16] md:aspect-auto">
                        <img id="outImg" class="w-full h-full object-cover">
                        <div id="imgLoad" class="absolute inset-0 bg-slate-950 flex flex-col items-center justify-center">
                            <div class="w-8 h-8 border-2 border-purple-500 border-t-transparent rounded-full animate-spin mb-3"></div>
                            <span class="text-[10px] text-purple-400 font-mono tracking-widest">RENDERING...</span>
                        </div>
                    </div>

                    <div class="md:w-1/2 p-8 md:p-12 flex flex-col justify-center bg-gradient-to-br from-slate-900/50 to-transparent">
                        <div class="mb-10">
                            <div class="text-purple-500 font-mono text-[10px] mb-4 tracking-tighter">CHARACTER_VERSE_V1.0</div>
                            <div id="outPoem" class="poem-font text-2xl md:text-3xl text-white font-bold leading-relaxed tracking-wide"></div>
                        </div>
                        
                        <div class="relative pt-6 border-t border-slate-800">
                            <div class="text-slate-600 font-mono text-[10px] mb-3 uppercase">English Interpretation</div>
                            <p id="outTrans" class="text-slate-400 italic text-sm md:text-base leading-relaxed"></p>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <script>
        async function generate() {
            const kws = [document.getElementById('kw1').value, document.getElementById('kw2').value, document.getElementById('kw3').value].filter(v => v.trim());
            if (kws.length < 1) return alert("请输入关键词");

            const btn = document.getElementById('btn');
            const resultBox = document.getElementById('resultBox');
            const emptyState = document.getElementById('emptyState');
            const imgLoad = document.getElementById('imgLoad');

            btn.disabled = true;
            btn.innerText = "数据处理中...";
            emptyState.classList.add('hidden');
            resultBox.classList.remove('hidden');
            imgLoad.classList.remove('hidden');

            try {
                // 1. 调用 Qwen 后端获取诗词和扩充提示词
                const res = await fetch('/.netlify/functions/generate', {
                    method: 'POST',
                    body: JSON.stringify({ keywords: kws })
                });
                const data = await res.json();

                // 2. 渲染文字
                document.getElementById('outPoem').innerText = data.poem;
                document.getElementById('outTrans').innerText = data.trans;

                // 3. 构建赛博风格图片请求
                // 强制全身照 (full body), 赛博朋克 (cyberpunk)
                const finalPrompt = encodeURIComponent(`full body shot, cyberpunk style, high detailed digital human, neon lighting, ${data.imgP}`);
                const seed = Math.floor(Math.random() * 99999);
                const imgUrl = `https://image.pollinations.ai/prompt/${finalPrompt}?width=720&height=1440&nologo=true&seed=${seed}`;
                
                const imgNode = document.getElementById('outImg');
                imgNode.src = imgUrl;
                imgNode.onload = () => imgLoad.classList.add('hidden');

            } catch (e) {
                alert("协议超时，请重试");
                resultBox.classList.add('hidden');
                emptyState.classList.remove('hidden');
            } finally {
                btn.disabled = false;
                btn.innerText = "重新同步神经链接";
            }
        }
    </script>
</body>
</html>
