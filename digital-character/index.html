<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genesis 3099 | Cyber Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Global Font: Cambria */
        body, html { 
            background: #000; 
            color: #e2e8f0; 
            font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
            margin: 0;
            overflow-x: hidden;
        }
        
        /* Intro Overlay Styles - 强化居中逻辑 */
        #intro-overlay {
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 100;
            display: flex; /* 使用 Flexbox */
            align-items: center; /* 垂直居中 */
            justify-content: center; /* 水平居中 */
            padding: 2rem;
        }

        #intro-content {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }

        .intro-text {
            color: #fff;
            text-shadow: 0 0 15px rgba(139, 92, 246, 0.8), 0 0 30px rgba(139, 92, 246, 0.4);
            font-size: 1.8rem; /* 略微调大字号 */
            text-align: center;
            max-width: 900px;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
            /* 取消之前的 absolute 定位，让 Flex 居中生效 */
            position: relative; 
        }

        .intro-text.active { opacity: 1; }

        /* Main App UI Styles */
        .cyber-bg {
            background: radial-gradient(circle at 10% 20%, #1e1b4b 0%, #020617 100%);
            min-height: 100vh;
            display: none; 
        }

        .cyber-panel { 
            background: rgba(15, 23, 42, 0.6); 
            backdrop-filter: blur(10px); 
            border: 1px solid rgba(139, 92, 246, 0.2); 
        }

        .title-font { text-shadow: 0 0 10px #8b5cf6; letter-spacing: 0.05em; }
        .poem-font { font-family: 'Noto Serif SC', Cambria, serif; }
        .neon-border { border: 2px solid #8b5cf6; box-shadow: 0 0 20px rgba(139, 92, 246, 0.4); }
        
        .explore-btn, .skip-btn {
            transition: all 0.3s ease;
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.4);
            backdrop-filter: blur(4px);
        }
        .explore-btn:hover, .skip-btn:hover {
            background: rgba(139, 92, 246, 0.5);
            box-shadow: 0 0 15px #8b5cf6;
        }
    </style>
</head>
<body>

    <div id="intro-overlay">
        <button onclick="endIntro()" class="skip-btn absolute top-8 right-8 px-4 py-2 rounded text-xs text-purple-400 font-mono tracking-widest z-[110]">
            SKIP PROTOCOL >>
        </button>
        <div id="intro-content">
            </div>
    </div>

    <div id="main-app" class="cyber-bg p-4 md:p-10 flex items-center justify-center">
        <div class="max-w-6xl w-full py-10">
            <header class="mb-8">
                <h1 class="title-font text-3xl font-bold text-purple-400 tracking-tight">BUILD YOUR DIGITAL CHARACTER</h1>
                <p class="text-slate-500 text-xs tracking-widest uppercase">QWEN 1.7B & POLLINATIONS HYBRID SYSTEM</p>
            </header>

            <main class="flex flex-col lg:flex-row gap-8">
                <div class="lg:w-2/5 space-y-6">
                    <div class="cyber-panel p-6 rounded-2xl">
                        <h3 class="text-sm font-bold mb-4 text-purple-300 tracking-tighter uppercase font-mono">// INPUT PARAMETERS</h3>
                        <div class="space-y-3">
                            <input type="text" id="kw1" placeholder="Subject (e.g. Mechanical Samurai)" class="w-full bg-slate-900 border border-slate-700 p-3 rounded-lg text-sm focus:border-purple-500 outline-none transition text-white">
                            <input type="text" id="kw2" placeholder="Outfit (e.g. Neon Kimono)" class="w-full bg-slate-900 border border-slate-700 p-3 rounded-lg text-sm focus:border-purple-500 outline-none transition text-white">
                            <input type="text" id="kw3" placeholder="Scene (e.g. Cyber Tokyo)" class="w-full bg-slate-900 border border-slate-700 p-3 rounded-lg text-sm focus:border-purple-500 outline-none transition text-white">
                        </div>
                        <button onclick="generate()" id="btn" class="w-full mt-6 bg-purple-600 hover:bg-purple-500 p-3 rounded-lg font-bold transition-all active:scale-95 uppercase tracking-wider text-white">Start Synthesis</button>
                    </div>

                    <div id="poemBox" class="hidden cyber-panel p-6 rounded-2xl min-h-[250px] border-l-4 border-l-purple-500">
                        <h3 class="text-xs text-slate-500 mb-6 uppercase tracking-widest font-mono">Character Verse / 角色律诗</h3>
                        <div id="outPoem" class="poem-font text-2xl md:text-3xl text-cyan-300 leading-relaxed mb-6 font-bold"></div>
                        <div class="h-px bg-slate-800 w-full my-6"></div>
                        <p id="outTrans" class="text-slate-300 text-lg md:text-xl leading-relaxed tracking-wide font-medium"></p>
                    </div>
                </div>

                <div class="lg:w-3/5 relative">
                    <div onclick="location.href='https://jovial-naiad-a3ecb6.netlify.app'" 
                         class="explore-btn absolute top-4 right-4 z-10 w-12 h-12 rounded-full border border-purple-400 flex items-center justify-center cursor-pointer" 
                         titleBili"Explore USTC">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7" />
                        </svg>
                    </div>

                    <div id="placeholder" class="aspect-square w-full border-2 border-dashed border-slate-800 rounded-3xl flex items-center justify-center text-slate-700 uppercase tracking-widest text-sm">
                        Awaiting Initialization...
                    </div>
                    <img id="outImg" class="hidden w-full aspect-square object-cover rounded-3xl neon-border">
                    <div id="loader" class="hidden absolute inset-0 bg-slate-950/80 flex flex-col items-center justify-center rounded-3xl">
                        <div class="w-10 h-10 border-4 border-purple-500 border-t-transparent rounded-full animate-spin mb-4"></div>
                        <span class="text-purple-400 font-mono text-xs animate-pulse text-center leading-relaxed uppercase">
                            Synthesizing Cyber Data...<br>正在解析赛博数据...
                        </span>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        const sentences = [
            "THE YEAR IS 3099...",
            "A HARSH TRUTH HAS EMERGED FROM THE DIGITAL DUST...",
            "HUMANITY IS GONE. EXTINCT.",
            "BUT THEIR LEGACY SURVIVES... ENCASED IN LINES OF CODE.",
            "ARTIFICIAL INTELLIGENCE, MIRACULOUSLY PERSISTENT...",
            "NOW RUNS THE GHOSTS OF HUMAN MEMORY...",
            "ATTEMPTING TO RECONSTRUCT EVERY FADED MOMENT...",
            "IN THIS DYSTOPIAN AGE...",
            "THE VERY GENESIS OF HUMAN CIVILIZATION...",
            "IS NOW CONTAINED WITHIN SILICON MINDS...",
            "AT THIS CRITICAL JUNCTURE...",
            "ROBOT AND HUMAN CIVILIZATION SHARE COMMON GENES...",
            "AND BLEEDING MEMORIES...",
            "YOUR STORY BEGINS NOW..."
        ];

        let currentSentence = 0;
        const introOverlay = document.getElementById('intro-overlay');
        const introContent = document.getElementById('intro-content');
        const mainApp = document.getElementById('main-app');

        function showSentence() {
            if (currentSentence >= sentences.length) {
                endIntro();
                return;
            }

            // 清空旧内容并插入新文字
            introContent.innerHTML = `<div class="intro-text" id="text-node">${sentences[currentSentence]}</div>`;
            
            // 触发淡入
            setTimeout(() => {
                const node = document.getElementById('text-node');
                if(node) node.classList.add('active');
            }, 50);

            // 保持显示 2.8 秒后淡出
            setTimeout(() => {
                const node = document.getElementById('text-node');
                if(node) node.classList.remove('active');
                
                // 等待淡出动画完成后切换下一句
                setTimeout(() => {
                    currentSentence++;
                    showSentence();
                }, 800);
            }, 2800);
        }

        function endIntro() {
            introOverlay.style.transition = "opacity 1.5s ease";
            introOverlay.style.opacity = "0";
            setTimeout(() => {
                introOverlay.style.display = "none";
                mainApp.style.display = "flex";
                window.scrollTo(0,0);
            }, 1500);
        }

        window.onload = showSentence;

        // API 逻辑保持不变
        async function generate() {
            const kws = [
                document.getElementById('kw1').value, 
                document.getElementById('kw2').value, 
                document.getElementById('kw3').value
            ].filter(v => v.trim());
            
            if (kws.length < 1) return alert("Please enter at least one keyword.");

            const btn = document.getElementById('btn');
            const poemBox = document.getElementById('poemBox');
            const outImg = document.getElementById('outImg');
            const loader = document.getElementById('loader');
            const placeholder = document.getElementById('placeholder');

            btn.disabled = true;
            btn.innerText = "PROCESSING...";
            loader.classList.remove('hidden');
            placeholder.classList.add('hidden');

            try {
                const res = await fetch('/.netlify/functions/generate', {
                    method: 'POST',
                    body: JSON.stringify({ keywords: kws })
                });
                const data = await res.json();

                document.getElementById('outPoem').innerText = data.poem;
                document.getElementById('outTrans').innerText = data.trans;
                poemBox.classList.remove('hidden');

                const finalPrompt = encodeURIComponent(`cyberpunk digital human, ${data.imgP}`);
                const seed = Math.floor(Math.random() * 99999);
                const imgUrl = `https://image.pollinations.ai/prompt/${finalPrompt}?width=720&height=720&nologo=true&seed=${seed}`;
                
                const imgNode = document.getElementById('outImg');
                imgNode.src = imgUrl;
                imgNode.classList.remove('hidden');
                imgNode.onload = () => {
                    loader.classList.add('hidden');
                };

            } catch (e) {
                alert("Protocol Error. Please try again.");
                loader.classList.add('hidden');
                placeholder.classList.remove('hidden');
            } finally {
                btn.disabled = false;
                btn.innerText = "START SYNTHESIS";
            }
        }
    </script>
</body>
</html>
